{
  "version": 3,
  "sources": ["../../../src/webview/views/settings.ts"],
  "sourcesContent": ["export {};\r\n\r\ntype BridgeMessage<TPayload = any> = {\r\n  type: string;\r\n  id?: string;\r\n  timestamp?: number;\r\n  payload?: TPayload;\r\n  response?: any;\r\n};\r\n\r\ndeclare const acquireVsCodeApi: () => { postMessage: (msg: any) => void };\r\n\r\nconst vscode = acquireVsCodeApi();\r\n\r\nconst pending = new Map<string, { resolve: (v: any) => void; reject: (e: any) => void; timeout: number }>();\r\n\r\nfunction genId(): string {\r\n  return `req_${Date.now()}_${Math.random().toString(36).slice(2, 10)}`;\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nfunction post(type: string, payload?: any): void {\r\n  vscode.postMessage({ type, id: genId(), timestamp: Date.now(), payload });\r\n}\r\n\r\nfunction request(type: string, payload?: any): Promise<any> {\r\n  const id = genId();\r\n  const message = { type, id, timestamp: Date.now(), payload };\r\n\r\n  return new Promise((resolve, reject) => {\r\n    const timeout = window.setTimeout(() => {\r\n      pending.delete(id);\r\n      reject(new Error(`Request timeout: ${type}`));\r\n    }, 15000);\r\n\r\n    pending.set(id, { resolve, reject, timeout });\r\n    vscode.postMessage(message);\r\n  });\r\n}\r\n\r\nwindow.addEventListener('message', (event: MessageEvent<BridgeMessage>) => {\r\n  const message = event.data;\r\n  if (!message) return;\r\n\r\n  if (message.id && Object.prototype.hasOwnProperty.call(message, 'response')) {\r\n    const p = pending.get(message.id);\r\n    if (!p) return;\r\n    window.clearTimeout(p.timeout);\r\n    pending.delete(message.id);\r\n\r\n    const resp = message.response;\r\n    if (resp && typeof resp === 'object' && 'error' in resp) {\r\n      p.reject(new Error(String((resp as any).error)));\r\n    } else {\r\n      p.resolve(resp);\r\n    }\r\n\r\n    return;\r\n  }\r\n});\r\n\r\nasync function loadConfiguration(): Promise<void> {\r\n  const config = await request('config.get');\r\n  const defaultProvider = document.getElementById('default-provider') as HTMLSelectElement | null;\r\n  const displayMode = document.getElementById('display-mode') as HTMLSelectElement | null;\r\n  const targetLang = document.getElementById('target-lang') as HTMLSelectElement | null;\r\n\r\n  if (defaultProvider) defaultProvider.value = config?.defaultProvider || 'deepseek';\r\n  if (displayMode) displayMode.value = config?.displayMode || 'simple';\r\n  if (targetLang) targetLang.value = config?.defaultTargetLang || 'zh';\r\n\r\n  await loadProviders();\r\n}\r\n\r\nasync function loadProviders(): Promise<void> {\r\n  const data = await request('config.providers.get');\r\n  const providers = data?.providers ? Object.values(data.providers) as any[] : [];\r\n\r\n  const providerList = document.getElementById('provider-list');\r\n  if (!providerList) return;\r\n\r\n  if (!providers.length) {\r\n    providerList.innerHTML = '<p style=\"color: var(--vscode-descriptionForeground);\">\u6682\u65E0\u914D\u7F6E\u7684\u670D\u52A1\u5546</p>';\r\n    return;\r\n  }\r\n\r\n  providerList.innerHTML = providers.map((p) => {\r\n    const configured = !!p.apiKey;\r\n    return `\r\n      <div style=\"padding: 12px; background: var(--vscode-editor-inactiveSelectionBackground); border-radius: 4px;\">\r\n        <div style=\"font-weight: 600; margin-bottom: 8px;\">\r\n          <span style=\"display:inline-block; width:8px; height:8px; border-radius:50%; margin-right:8px; background:${configured ? 'var(--vscode-testing-iconPassed)' : 'var(--vscode-testing-iconFailed)'};\"></span>\r\n          ${escapeHtml(String(p.name || p.id))}\r\n        </div>\r\n\r\n        <div style=\"display:flex; flex-direction:column; gap:10px;\">\r\n          <div>\r\n            <label style=\"display:block; margin-bottom:6px;\">API Key</label>\r\n            <input type=\"password\" id=\"apiKey-${escapeHtml(String(p.id))}\" value=\"${escapeHtml(String(p.apiKey || ''))}\" placeholder=\"\u8F93\u5165 API Key\" style=\"width:100%;\" />\r\n          </div>\r\n\r\n          <div>\r\n            <label style=\"display:block; margin-bottom:6px;\">Base URL</label>\r\n            <input type=\"text\" id=\"endpoint-${escapeHtml(String(p.id))}\" value=\"${escapeHtml(String(p.apiEndpoint || p.baseUrl || ''))}\" placeholder=\"https://api.example.com\" style=\"width:100%;\" />\r\n          </div>\r\n\r\n          <div>\r\n            <label style=\"display:block; margin-bottom:6px;\">\u6A21\u578B</label>\r\n            <input type=\"text\" id=\"model-${escapeHtml(String(p.id))}\" value=\"${escapeHtml(String(p.model || ''))}\" placeholder=\"model\" style=\"width:100%;\" />\r\n          </div>\r\n\r\n          <button class=\"btn-save-provider\" data-provider-id=\"${escapeHtml(String(p.id))}\">\u4FDD\u5B58</button>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }).join('');\r\n}\r\n\r\nasync function saveGeneralSettings(): Promise<void> {\r\n  const defaultProvider = (document.getElementById('default-provider') as HTMLSelectElement | null)?.value;\r\n  const displayMode = (document.getElementById('display-mode') as HTMLSelectElement | null)?.value;\r\n  const targetLang = (document.getElementById('target-lang') as HTMLSelectElement | null)?.value;\r\n\r\n  await request('config.update', { key: 'defaultProvider', value: defaultProvider });\r\n  await request('config.update', { key: 'displayMode', value: displayMode });\r\n  await request('config.update', { key: 'defaultTargetLang', value: targetLang });\r\n\r\n  post('notification.show', { message: '\u8BBE\u7F6E\u5DF2\u4FDD\u5B58', type: 'info' });\r\n}\r\n\r\nasync function saveProviderConfig(providerId: string): Promise<void> {\r\n  const apiKey = (document.getElementById(`apiKey-${providerId}`) as HTMLInputElement | null)?.value || '';\r\n  const apiEndpoint = (document.getElementById(`endpoint-${providerId}`) as HTMLInputElement | null)?.value || '';\r\n  const model = (document.getElementById(`model-${providerId}`) as HTMLInputElement | null)?.value || '';\r\n\r\n  await request('config.providers.update', {\r\n    providerId,\r\n    config: {\r\n      apiKey,\r\n      apiEndpoint,\r\n      model,\r\n    },\r\n  });\r\n\r\n  post('notification.show', { message: '\u670D\u52A1\u5546\u914D\u7F6E\u5DF2\u4FDD\u5B58', type: 'info' });\r\n  await loadProviders();\r\n}\r\n\r\nfunction switchTab(tabName: string): void {\r\n  document.querySelectorAll<HTMLButtonElement>('.tab').forEach((tab) => {\r\n    tab.classList.toggle('active', tab.dataset.tab === tabName);\r\n  });\r\n\r\n  document.querySelectorAll<HTMLElement>('.tab-content').forEach((content) => {\r\n    content.classList.remove('active');\r\n  });\r\n\r\n  document.getElementById(`tab-${tabName}`)?.classList.add('active');\r\n}\r\n\r\nfunction init(): void {\r\n  document.addEventListener('click', async (e) => {\r\n    const target = e.target as HTMLElement | null;\r\n    if (!target) return;\r\n\r\n    if (target.classList.contains('tab')) {\r\n      const tabName = target.dataset.tab;\r\n      if (tabName) switchTab(tabName);\r\n      return;\r\n    }\r\n\r\n    if (target.id === 'save-general') {\r\n      try {\r\n        await saveGeneralSettings();\r\n      } catch (err) {\r\n        post('notification.show', { message: (err as Error).message || '\u4FDD\u5B58\u5931\u8D25', type: 'error' });\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (target.classList.contains('btn-save-provider')) {\r\n      const providerId = target.getAttribute('data-provider-id');\r\n      if (!providerId) return;\r\n      try {\r\n        await saveProviderConfig(providerId);\r\n      } catch (err) {\r\n        post('notification.show', { message: (err as Error).message || '\u4FDD\u5B58\u5931\u8D25', type: 'error' });\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (target.id === 'add-template') {\r\n      post('notification.show', { message: '\u6A21\u677F\u7F16\u8F91\u529F\u80FD\u5F00\u53D1\u4E2D...', type: 'info' });\r\n      return;\r\n    }\r\n\r\n    if (target.id === 'add-provider') {\r\n      post('notification.show', { message: '\u8BF7\u901A\u8FC7\u5185\u7F6E\u670D\u52A1\u5546\u914D\u7F6E\u9879\u8FDB\u884C\u914D\u7F6E', type: 'info' });\r\n      return;\r\n    }\r\n  });\r\n\r\n  loadConfiguration().catch((err) => {\r\n    post('notification.show', { message: err?.message || '\u52A0\u8F7D\u914D\u7F6E\u5931\u8D25', type: 'error' });\r\n  });\r\n\r\n  post('panel.focus');\r\n}\r\n\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', init);\r\n} else {\r\n  init();\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
